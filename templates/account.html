{% extends 'layout.html' %}
{% block content %}
<style>
  .acct-shell {
    border: 1px solid var(--border); border-radius: var(--radius-lg);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    box-shadow: 0 20px 60px rgba(0,0,0,0.45); padding: 34px; max-width: 980px; margin: 0 auto;
  }
  .acct-shell h1 { margin-bottom: 4px; }
  .acct-sub { color: var(--text-muted); margin: 0 0 16px; font-size: 15px; }
  .acct-topbar { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; justify-content: space-between; margin-bottom: 18px; }
  .acct-pill {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 10px 16px; border-radius: 999px;
    border: 1px solid var(--border); background: rgba(0,0,0,0.18);
    color: var(--text-muted); font-size: 13px;
  }
  .acct-pill strong { color: var(--text); }
  .acct-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  @media (max-width: 900px) { .acct-grid { grid-template-columns: 1fr; } }
  .acct-card {
    border: 1px solid var(--border); border-radius: 16px;
    background: var(--surface); padding: 22px;
  }
  .acct-card h2 { font-family: 'Space Grotesk', sans-serif; margin: 0 0 6px; font-size: 18px; }
  .acct-card .hint { color: var(--text-muted); font-size: 13px; margin: 0 0 14px; }
  .acct-card label { display: block; font-size: 13px; color: var(--text-muted); margin: 10px 0 6px; }
  .acct-card input, .acct-card select {
    width: 100%; padding: 11px 12px; border-radius: 11px;
    border: 1px solid var(--border); background: rgba(0,0,0,0.2);
    color: var(--text); outline: none; font-size: 14px;
  }
  .acct-card input:focus { border-color: rgba(59,130,246,0.5); box-shadow: 0 0 0 3px rgba(59,130,246,0.12); }
  .acct-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
  .kv { display: grid; grid-template-columns: 140px 1fr; gap: 6px 16px; font-size: 14px; }
  .kv .k { color: var(--text-muted); }
  .toggle { display: flex; align-items: center; gap: 10px; margin: 8px 0; }
  .toggle input { width: auto; accent-color: var(--brand); }
  .toggle label { margin: 0; color: var(--text); font-size: 14px; }
  .acct-small { color: var(--text-muted); font-size: 13px; margin-top: 18px; }
  .acct-small a { color: #93b4ff; }
</style>

<div class="acct-shell">
  <h1>Account</h1>
  <p class="acct-sub">Manage your Signal Hawk access, billing, and alert preferences.</p>

  <div class="acct-topbar">
    <span class="acct-pill">Signed in as <strong>{{ user.email }}</strong></span>
  </div>

  <div class="acct-grid">
    <!-- Profile -->
    <div class="acct-card">
      <h2>Profile</h2>
      <p class="hint">Update your contact information.</p>
      <form method="POST" action="{{ url_for('account_profile_update') }}">
        <label>Email</label>
        <input name="email" type="email" value="{{ user.email }}" required>
        <label>Phone</label>
        <input name="phone" type="text" value="{{ user.phone or '' }}" placeholder="e.g. +1 555 123 4567">
        <div class="acct-actions"><button class="btn primary" type="submit">Save profile</button></div>
      </form>
    </div>

    <!-- Subscription -->
    <div class="acct-card">
      <h2>Subscription</h2>
      <p class="hint">View status and manage billing through Stripe.</p>
      <div class="kv">
        <div class="k">Status</div><div>{{ user.subscription_status or '—' }}</div>
        <div class="k">Plan</div><div>{{ user.plan or '—' }}</div>
        <div class="k">Customer ID</div><div>{{ user.stripe_customer_id or '—' }}</div>
      </div>
      <div class="acct-actions">
        <form method="POST" action="{{ url_for('account_billing_portal') }}">
          <button class="btn primary" type="submit">Manage billing</button>
        </form>
        <a class="btn ghost" href="{{ url_for('signup') }}">Change plan</a>
      </div>
    </div>

    <!-- Notifications -->
    <div class="acct-card">
      <h2>Notifications</h2>
      <p class="hint">Control how we alert you.</p>
      <form method="POST" action="{{ url_for('account_notifications_update') }}">
        <div class="toggle">
          <input id="email_alerts" name="email_alerts" type="checkbox" {% if user.email_alerts %}checked{% endif %}>
          <label for="email_alerts">Email alerts</label>
        </div>
        <div class="toggle">
          <input id="sms_alerts" name="sms_alerts" type="checkbox" {% if user.sms_alerts %}checked{% endif %}>
          <label for="sms_alerts">SMS alerts</label>
        </div>
        <div class="toggle">
          <input id="marketing_emails" name="marketing_emails" type="checkbox" {% if user.marketing_emails %}checked{% endif %}>
          <label for="marketing_emails">Product updates (optional)</label>
        </div>
        <div class="acct-actions"><button class="btn primary" type="submit">Save notifications</button></div>
      </form>
    </div>

    <!-- Security -->
    <div class="acct-card">
      <h2>Security</h2>
      <p class="hint">Change your password.</p>
      <form method="POST" action="{{ url_for('account_password_update') }}">
        <label>New password</label>
        <input name="password" type="password" minlength="10" placeholder="At least 10 characters">
        <label>Confirm new password</label>
        <input name="password2" type="password" minlength="10" placeholder="Re-enter password">
        <div class="acct-actions"><button class="btn ghost" type="submit">Update password</button></div>
      </form>
      <div class="acct-actions" style="margin-top:18px;">
        <a class="btn primary" href="{{ url_for('analyzer') }}">Open Investment Analyzer</a>
      </div>
    </div>
  </div>

  <p class="acct-small">If you did not create this account, contact <a href="mailto:signal.hawk.capital@gmail.com">signal.hawk.capital@gmail.com</a>.</p>
</div>
{% endblock %}
