{% extends 'layout.html' %}
{% block content %}
<style>
  .signup-wrap { max-width: 960px; margin: 0 auto; }
  .signup-wrap h1 { text-align: center; }
  .signup-sub { text-align: center; color: var(--text-muted); margin-bottom: 36px; font-size: 16px; }

  .plan-toggle {
    display: flex; justify-content: center; gap: 8px; margin-bottom: 12px;
  }
  .plan-toggle button {
    padding: 10px 20px; border-radius: 10px; border: 1px solid var(--border2);
    background: var(--surface); color: var(--text-muted); font-weight: 600;
    cursor: pointer; transition: all 0.2s; font-size: 14px;
  }
  .plan-toggle button.active {
    background: var(--brand); border-color: var(--brand); color: #fff;
  }
  .type-hint { text-align: center; font-size: 13px; color: var(--text-muted); margin-bottom: 28px; max-width: 640px; margin-left: auto; margin-right: auto; line-height: 1.6; }

  .pricing-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 10px; }
  @media (max-width: 768px) { .pricing-grid { grid-template-columns: 1fr; } }
  .price-card {
    background: var(--surface); border: 2px solid var(--border);
    border-radius: var(--radius-lg); padding: 28px; text-align: center;
    cursor: pointer; transition: all 0.2s; position: relative;
  }
  .price-card:hover { border-color: var(--border2); transform: translateY(-2px); }
  .price-card.selected { border-color: var(--brand); box-shadow: 0 0 0 1px var(--brand), 0 8px 24px var(--brand-glow); }
  .price-card .plan-name { font-size: 18px; font-weight: 700; margin-bottom: 8px; font-family: 'Space Grotesk', sans-serif; }
  .price-card .price { font-size: 36px; font-weight: 700; font-family: 'Space Grotesk', sans-serif; }
  .price-card .price span { font-size: 16px; color: var(--text-muted); font-weight: 400; }
  .price-card .desc { color: var(--text-muted); font-size: 13px; margin-top: 8px; }
  .badge {
    position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
    background: var(--accent); color: #fff; font-size: 11px; font-weight: 700;
    padding: 4px 12px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.05em;
  }
  .savings-text { text-align: center; font-size: 14px; color: var(--accent); margin-bottom: 28px; min-height: 20px; }

  .checkout-form { max-width: 480px; margin: 0 auto; }
  .checkout-form label { display: block; font-size: 13px; color: var(--text-muted); margin: 14px 0 6px; }
  .checkout-form input[type="email"],
  .checkout-form input[type="tel"] {
    width: 100%; padding: 12px 14px; border-radius: 12px;
    border: 1px solid var(--border); background: rgba(0,0,0,0.2);
    color: var(--text); font-size: 14px; outline: none;
  }
  .checkout-form input:focus { border-color: rgba(59,130,246,0.5); box-shadow: 0 0 0 3px rgba(59,130,246,0.12); }
  .terms-check { display: flex; align-items: flex-start; gap: 10px; margin: 18px 0; font-size: 13px; color: var(--text-muted); line-height: 1.6; }
  .terms-check input { width: auto; margin-top: 3px; accent-color: var(--brand); flex-shrink: 0; }
  .terms-check a { color: var(--brand); }
  #checkout-btn { width: 100%; margin-top: 8px; font-size: 16px; padding: 14px; }
  #checkout-error { color: #fca5a5; font-size: 13px; margin-top: 10px; display: none; }
  .checkout-hint { text-align: center; font-size: 13px; color: var(--text-muted); margin-top: 12px; }
</style>

<div class="signup-wrap">
  <h1>Subscribe to Signal Hawk</h1>
  <p class="signup-sub">Get real-time buy &amp; sell alerts on S&amp;P 500 and SPXL strategies.</p>

  <div class="plan-toggle">
    <button class="active" onclick="setType('individual', this)">Individual</button>
    <button onclick="setType('professional', this)">Professional</button>
  </div>
  <p class="type-hint">Individual pricing is for personal investors using our signals solely for their own accounts. Professional pricing applies to advisors, fund managers, institutions, or anyone using signals to manage capital on behalf of others.</p>

  <div class="pricing-grid">
    <div class="price-card" data-plan="monthly" onclick="selectPlan('monthly', this)">
      <div class="plan-name">Monthly</div>
      <div class="price" id="price-monthly">$120<span>/mo</span></div>
      <div class="desc">Cancel anytime</div>
    </div>
    <div class="price-card selected" data-plan="yearly" onclick="selectPlan('yearly', this)">
      <div class="badge">Best Value</div>
      <div class="plan-name">Yearly</div>
      <div class="price" id="price-yearly">$1,000<span>/yr</span></div>
      <div class="desc">Billed annually</div>
    </div>
    <div class="price-card" data-plan="lifetime" onclick="selectPlan('lifetime', this)">
      <div class="plan-name">10 Year</div>
      <div class="price" id="price-lifetime">$7,000</div>
      <div class="desc">One-time payment</div>
    </div>
  </div>
  <p class="savings-text" id="savings-text"></p>

  <div class="checkout-form">
    <label>Email</label>
    <input type="email" id="co-email" placeholder="you@example.com" required>
    <label>Phone (for alerts)</label>
    <input type="tel" id="co-phone" placeholder="+1 555 555 5555" required>

    <div class="terms-check">
      <input type="checkbox" id="co-terms">
      <span>I acknowledge that Signal Hawk Capital, LLC provides educational information only, is not a registered
        investment adviser, and that investing involves risk including loss of principal. I agree to the
        <a href="{{ url_for('terms') }}" target="_blank">Terms and Conditions</a>,
        <a href="{{ url_for('disclosures') }}" target="_blank">Important Disclosures</a>, and
        <a href="{{ url_for('privacy') }}" target="_blank">Privacy Policy</a>.</span>
    </div>

    <button class="btn success" id="checkout-btn">Subscribe</button>
    <div id="checkout-error"></div>
    <p class="checkout-hint">After successful subscription, you'll receive an email with instructions to create your account and begin receiving alerts.</p>
  </div>
</div>

<script>
let selectedPlan = 'yearly';
let investorType = 'individual';

const BASE = { monthly: 120, yearly: 1000, lifetime: 7000 };

function formatPrice(n) { return '$' + n.toLocaleString(); }

function updatePrices() {
  const f = investorType === 'professional' ? 10 : 1;
  document.getElementById('price-monthly').innerHTML = formatPrice(BASE.monthly * f) + '<span>/mo</span>';
  document.getElementById('price-yearly').innerHTML = formatPrice(BASE.yearly * f) + '<span>/yr</span>';
  document.getElementById('price-lifetime').innerHTML = formatPrice(BASE.lifetime * f);
  updateSavings();
}

function updateSavings() {
  const f = investorType === 'professional' ? 10 : 1;
  const monthly = BASE.monthly * f;
  const yearly = BASE.yearly * f;
  const lifetime = BASE.lifetime * f;
  const el = document.getElementById('savings-text');
  el.textContent = '';
  if (selectedPlan === 'yearly') {
    const pct = Math.round((1 - (yearly / 12) / monthly) * 100);
    if (pct > 0) el.textContent = 'Save ~' + pct + '% vs paying monthly.';
  } else if (selectedPlan === 'lifetime') {
    const pct = Math.round((1 - (lifetime / (12 * 10)) / monthly) * 100);
    if (pct > 0) el.textContent = 'Save ~' + pct + '% over 10 years vs monthly.';
  }
}

function selectPlan(plan, el) {
  selectedPlan = plan;
  document.querySelectorAll('.price-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  updateSavings();
}

function setType(type, el) {
  investorType = type;
  document.querySelectorAll('.plan-toggle button').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  updatePrices();
}

document.getElementById('checkout-btn').addEventListener('click', async () => {
  const errEl = document.getElementById('checkout-error');
  errEl.style.display = 'none';

  const email = document.getElementById('co-email').value.trim();
  const phone = document.getElementById('co-phone').value.trim();
  const terms = document.getElementById('co-terms').checked;

  if (!email || !phone) { errEl.textContent = 'Please fill in email and phone.'; errEl.style.display = 'block'; return; }
  if (!terms) { errEl.textContent = 'You must accept the Terms, Disclosures, and Privacy Policy to continue.'; errEl.style.display = 'block'; return; }

  const btn = document.getElementById('checkout-btn');
  btn.disabled = true; btn.textContent = 'Redirectingâ€¦';

  try {
    const res = await fetch('/create-checkout-session', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email, phone, plan: selectedPlan,
        investorType, accepted_terms: true
      })
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error(text || 'Checkout failed');
    }
    const data = await res.json();
    window.location.href = data.url;
  } catch (e) {
    errEl.textContent = e.message; errEl.style.display = 'block';
    btn.disabled = false; btn.textContent = 'Subscribe';
  }
});

updatePrices();
</script>
{% endblock %}
